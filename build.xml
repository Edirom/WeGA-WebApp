<?xml version="1.0" encoding="UTF-8"?>
<project default="xar" name="WeGA-WebApp">
    
    <!-- import default properties from file -->
    <property file="local.build.properties"/>
    <property file="build.properties"/>
    
    <target name="all" depends="xar"/>
    <target name="rebuild" depends="clean,all"/>
    
    <target name="clean">
        <delete dir="${tmp.dir}"/>
        <delete dir="${dist.dir}"/>
        <delete file="expath-pkg.xml"/>
    </target>
    
    <target name="clean-all" depends="clean">
        <delete dir="bower_components"/>
    </target>
    
    <target name="init">
        <mkdir dir="${build.dir}"/>
        <mkdir dir="${tmp.dir}"/>
        <mkdir dir="${dist.dir}"/>
    </target>
    
    <target name="download-smufl-font" depends="init">
        <description>Download Bravura font from the official website</description>
        <get src="${smufl.font}" dest="${tmp.dir}/bravura.zip" skipexisting="yes"/>
        <unzip src="${tmp.dir}/bravura.zip" dest="${tmp.dir}"/>
    </target>
    
    <target name="bower" depends="init">
        <description>Update javascript libraries via bower</description>
        <exec executable="bower">
            <arg value="update"/>
        </exec>
    </target>
    
    <target name="less" depends="init">
        <description>Create CSS files via less</description>
        <exec executable="lessc">
            <arg line="resources/less/styles.less ${dist.dir}/resources/css/styles.css"/>
        </exec>
    </target>
    
    <target name="dist" depends="init, download-smufl-font, bower, less">
        <copy file="expath-pkg.xml.tmpl" tofile="${dist.dir}/expath-pkg.xml" filtering="true" overwrite="true">
            <filterset>
                <filter token="project.version" value="${project.version}"/>
            </filterset>
        </copy>
        <!-- Copy everything from base.dir -->
        <copy todir="${dist.dir}">
            <fileset dir=".">
                <include name="*.*"/>
                <include name="modules/**"/>
                <include name="resources/**"/>
                <include name="catalogues/**"/>
                <include name="indices/**"/>
                <include name="templates/**"/>
                <include name="xsl/**"/>
                <exclude name="build.xml"/>
                <exclude name="*build.properties"/>
                <exclude name=".git*"/>
                <exclude name="*.tmpl"/>
                <exclude name="*.txt"/>
                <exclude name="bower.json"/>
                <exclude name="**/less/**"/>
            </fileset>
        </copy>
        <!-- Copy additional fonts -->
        <copy todir="${dist.dir}/resources/fonts">
            <fileset dir="${tmp.dir}/eot/">
                <include name="BravuraText.*"/>
                <!--<include name="BravuraText.eot"/>-->
                <!--<include name="BravuraText.woff"/>-->
                <!--<include name="BravuraText.otf"/>-->
                <!--<include name="BravuraText.svg"/>-->
            </fileset>
            <fileset dir="${tmp.dir}/woff/">
                <include name="BravuraText.*"/>
            </fileset>
            <fileset dir="${tmp.dir}/otf/">
                <include name="BravuraText.*"/>
            </fileset>
            <fileset dir="${tmp.dir}/svg/">
                <include name="BravuraText.*"/>
            </fileset>
            <fileset dir="${wega.fonts.dir}">
                <include name="2B*.*"/>
            </fileset>
            <fileset dir="bower_components/bootstrap/dist/fonts/">
                <include name="*.*"/>
            </fileset>
            <fileset dir="bower_components/fontawesome/fonts/">
                <include name="fontawesome-webfont.*"/>
            </fileset>
        </copy>
        <!-- Copy additional images -->
        <copy todir="${dist.dir}/resources/img">
            <fileset dir="${wega.img.dir}">
                <include name="*.*"/>
            </fileset>
        </copy>
        <!-- Copy Javascripts from bower components -->
        <copy todir="${dist.dir}/resources/js">
            <fileset dir="bower_components/bootstrap/dist/js">
                <include name="bootstrap.min.js"/>
            </fileset>
            <fileset dir="bower_components/bootstrap-select/dist/js">
                <include name="bootstrap-select.min.js"/>
                <include name="bootstrap-select.js.map"/>
            </fileset>
            <fileset dir="bower_components/FitText.js">
                <include name="jquery.fittext.js"/>
            </fileset>
            <fileset dir="bower_components/jquery/dist">
                <include name="jquery.js"/>
                <include name="jquery.min.js"/>
                <include name="jquery.min.map"/>
            </fileset>
            <fileset dir="bower_components/Easy-Responsive-Tabs-to-Accordion/js">
                <include name="easyResponsiveTabs.js"/>
            </fileset>
            <fileset dir="bower_components/google-code-prettify/bin">
                <include name="prettify.min.js"/>
            </fileset>
            <fileset dir="bower_components/bootstrap-hover-dropdown">
                <include name="bootstrap-hover-dropdown.min.js"/>
            </fileset>
            <fileset dir="bower_components/bootstrap-remote-data/js">
                <include name="bootstrap-remote-tabs.min.js"/>
<!--                <include name="jquery.loadmask.js"/>-->
            </fileset>
        </copy>
        <!-- Copy CSS from bower components -->
        <copy todir="${dist.dir}/resources/css">
            <fileset dir="bower_components/bootstrap/dist/css">
                <include name="bootstrap.min.css"/>
                <include name="bootstrap.css.map"/>
                <include name="bootstrap-theme.min.css"/>
                <include name="bootstrap-theme.css.map"/>
            </fileset>
            <fileset dir="bower_components/bootstrap-select/dist/css">
                <include name="bootstrap-select.min.css"/>
            </fileset>
            <fileset dir="bower_components/fontawesome/css">
                <include name="font-awesome.min.css"/>
            </fileset>
            <fileset dir="bower_components/Easy-Responsive-Tabs-to-Accordion/css">
                <include name="easy-responsive-tabs.css"/>
            </fileset>
            <fileset dir="bower_components/google-code-prettify/bin">
                <include name="prettify.min.css"/>
            </fileset>
            <!--<fileset dir="bower_components/bootstrap-remote-data/css">
                <include name="jquery.loadmask.css"/>
            </fileset>-->
        </copy>
    </target>
    
    <target name="xar" depends="init, dist">
        <zip destfile="${build.dir}/${project.app}-${project.version}.xar">
            <fileset dir="${dist.dir}"/>
        </zip>
    </target>
</project>
